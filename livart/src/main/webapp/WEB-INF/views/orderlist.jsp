<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<script src="http://code.jquery.com/jquery-latest.min.js"></script>
	<%@ include file="../../static/header.jsp"%>

	<main id="container" role="main">

		<div class="container">
			<div class="section-category-contents section-contents-wrap clear">
				<!-- S : LNB -->
				<aside class="lnb-content">
					<section>
						<h3 class="lnb-content-title">주문내역</h3>
						<ul class="lnb-content-list">

							<li><a href="#" class="is-active">주문배송관리</a>

								<ul>


									<li><a href="#" class="">주문 내역</a></li>


									<!--            	<li><a href="#" class="is-active">취소/교환/반품 내역</a></li>     -->



								</ul></li>
							<!--       
	                    <li><a href="/mypage/psnPayList" class="">결제정보관리</a>
	                        
		                        <ul>
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/psnPayList" class="">개인결제창관리</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/mypageRefundAccountInfo" class="">환불계좌관리</a></li>
	                                        
	                                    
		                            
		                        </ul>
	                        
	                    </li>
                    
	                    <li><a href="/mypage/myInterestGoodsList" class="">관심상품관리</a>
	                        
		                        <ul>
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myInterestGoodsList" class="">찜한상품</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/stockArm" class="">입고알림</a></li>
	                                        
	                                    
		                            
		                        </ul>
	                        
	                    </li>
                    
	                    <li><a href="/mypage/myCouponList" class="">내쿠폰함</a>
	                        
	                    </li>
                    
	                    <li><a href="/mypage/myInquiry" class="">문의내역</a>
	                        
		                        <ul>
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myInquiry" class="">1:1문의</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/goodsQna" class="">상품문의</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myVoc" class="">고객의소리</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myQuantity" class="">대량구매</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
				                    			
	                                        
	                                        
	                                    
		                            
		                        </ul>
	                        
	                    </li>
                    
	                    <li><a href="/mypage/reviewList" class="">활동내역관리</a>
	                        
		                        <ul>
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/reviewList" class="">상품리뷰관리</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myEventList" class="">이벤트참여내역</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/mypageAsAccpList" class="">A/S예약내역</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/mypageMvInstList" class="">이전설치예약내역</a></li>
	                                        
	                                    
		                            
		                        </ul>
	                        
	                    </li>
                    
	                    <li><a href="/mypage/myPosts" class="">커뮤니티활동</a>
	                        
		                        <ul>
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myPosts" class="">등록게시물</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/community" class="">관심게시물</a></li>
	                                        
	                                    
		                            
		                        </ul>
	                        
	                    </li>
                    
	                    <li><a href="/mypage/myInfoSetting" class="">회원정보관리</a>
	                        
		                        <ul>
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myInfoSetting" class="">내정보수정</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/memberGradeInfo" class="">회원등급안내</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/weddingRegistration" class="">웨딩회원신청</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/myDeliveryPointList" class="">배송지관리</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/staffAppyInfo" class="">임직원신청</a></li>
	                                        
	                                    
		                            
		                            	
				                    		
	                                        
	                                        	<li><a href="/mypage/psnInfoUsage" class="">개인정보 이용현황</a></li>
	                                        
	                                    
		                            
		                        </ul>
	                        
	                    </li>
                     -->
						</ul>
					</section>
				</aside>
				<!-- E : LNB -->
				<div class="section-category-right float-right">




					<section class="section-category-right float-right">
						<h3 class="content-title--normal">주문 내역</h3>

						<!-- 	
	<div class="section-contents-events__dateselect is-non-margin">
		<form>
			<fieldset>
				<legend>날짜 기간 조회하기</legend>
				<div class="date-select-wrap">
					<div class="date-select-month">
						<ul class="time-select-wrap is-flex">
							<li>
								<input type="radio" id="selectMonth01" class="radio time-select" name="selectMonth" onclick="setMonth('2022-11-07');" checked="">
								<label for="selectMonth01" class="label"><span class="txt">1개월</span></label>
							</li>
							<li>
								<input type="radio" id="selectMonth02" class="radio time-select" name="selectMonth" onclick="setMonth('2022-09-07');">
								<label for="selectMonth02" class="label"><span class="txt">3개월</span></label>
							</li>
							<li>
								<input type="radio" id="selectMonth03" class="radio time-select" name="selectMonth" onclick="setMonth('2022-06-07');">
								<label for="selectMonth03" class="label"><span class="txt">6개월</span></label>
							</li>
							<li>
								<input type="radio" id="selectMonth04" class="radio time-select" name="selectMonth" onclick="setMonth('2021-12-07');">
								<label for="selectMonth04" class="label"><span class="txt">1년</span></label>
							</li>
						</ul>
					</div>
					<div class="datepicker-wrap">
						<input type="text" class="input datepicker hasDatepicker" id="startDate" name="startDate" value="2022.11.07" readonly="readonly" period-valid-check="true" data-year="button" onchange="checkSearchDate();"> ~
						<input type="text" class="input datepicker hasDatepicker" id="endDate" name="endDate" value="2022.12.07" readonly="readonly" period-valid-check="true" data-year="button" onchange="checkSearchDate();">
						<button type="button" class="button is-primary" id="btnNewOrder" onclick="goNewPage(1);">조회하기</button>
					</div>
					<button type="button" class="button ml2 modal-button" id="btnOldOrder" data-target="modal-claim-history-20" onclick="goOldPage(1)">20년 12월 이전</button>
				</div>
			</fieldset>
		</form>
	</div>

 -->





						<span id="mypageClaimList">

							<div class="section-contents-table__table--wrap">
								<h4 class="content-title--subtitle">주문 내역</h4>
								<table class="section-contents-table__table check__group">
									<caption>주문 목록</caption>
									<colgroup>
										<col style="width: 170px;">
										<col style="width: 150px;">
										<col>
										<col style="width: 80px;">
										<col style="width: 150px;">
										<col style="width: 170px;">
									</colgroup>
									<thead>
										<tr>
											<th align="" scope="col">주문번호
											<br>(주문 날짜)
											</th>
											
											<th align="" scope="col" colspan="2">상품명</th>
											<th align="" scope="col">수량</th>
											<th align="" scope="col">주문금액</th>
											<th align="" scope="col">관리</th>
										</tr>
									</thead>
									<tbody>


								<!-- 주문id별 상품 출력 -->
										<c:forEach var="orderlist" items="${orderItemList }"
											varStatus="orderNum">
											<tr class="bundle-delivery">
												<td id="clmNoRsp_clm_20221205_0000034">
														<div class="date-order-number-wrap">
															<span class="date">${orderlist.p_id }_N${orderlist.o_id }</span>
															<div class="order-number">
															(${orderlist.created_at })
																<!--	(<span>ord_20221201_0000108</span>) -->
															</div>
														</div>
												</a></td>

												<td class="item-image"><a href="/p/P200106872">
														<div class="section-contents-item__image">
															<img class="img" src="${orderlist.p_url}"
																data-scale="250">
														</div>
												</a></td>
												<td class="item-option"><a href="/p/P200106872">
														<div class="section-contents-item">
															<!-- 		<span class="section-contents-item__brand">리바트온라인</span>  -->
															<p class="section-contents-item__name">

																<span class="section-contents-item__name--text">${orderlist.p_name}
																</span>
															</p>
														</div>
												</a></td>
												<td><span class="item-quantity">${orderlist.quantity}</span></td>
												<td id="payAmtRsp_clm_20221205_0000034">
													<div class="price item-price">
														<fmt:formatNumber
															value="${orderlist.p_price * orderlist.quantity}"
															type="number" />
														<span class="won">원</span>
													</div>
												</td>



												<td>
													<div class="section-contents-item__simple">
														<div class="section-contents-item__simple--button">
														
															<!-- 주문 완료 && 리뷰 작성하지 않았을 경우 -->
															<c:choose>
																<c:when test="${orderlist.d_status == 'INACTIVE' and orderlist.r_status == 'INACTIVE'}">

																	<button type="button"
																		class="button is-small is-light is-interval delete_btn"
																		data-orderid="${orderlist.o_id}"
																		data-productid="${orderlist.p_id}"
																		aria-haspopup="true">주문 취소</button>

																</c:when>

														
																<c:when test="${orderlist.d_status == 'ACTIVE' }">
																<div>취소 완료</div>
																</c:when>
																					
																<c:when test="${orderlist.d_status == 'INACTIVE' and orderlist.r_status == 'ACTIVE'}">
																<div>구매 확정</div>                 
																</c:when>
															</c:choose>

								 						
								 						<c:choose>
								 							<c:when test="${orderlist.d_status == 'INACTIVE' and orderlist.r_status == 'INACTIVE'}">
															<button type="button"
																class="button is-small is-light is-interval review_btn"
																data-orderid="${orderlist.o_id}"
																data-productid="${orderlist.p_id}"
																aria-haspopup="true">리뷰작성</button>
															</c:when>
															
														
															<c:when test="${orderlist.d_status == 'INACTIVE' and orderlist.r_status == 'ACTIVE'}">
															<div style="margin-top:10px">작성 완료</div>
															</c:when>
															
														
															<c:when test="${orderlist.d_status == 'ACTIVE'}">
															<div style="margin-top:10px">리뷰 불가</div>
															</c:when>
														</c:choose>
														</div>
													</div>
												</td>
											</tr>
										</c:forEach>
									</tbody>
								</table>
							</div> <!--hr/>1<br/>5<br/>1<br/>1<hr/-->



							<div class="pitem-qna-pagination">
								<nav class="pagination is-centered" role="navigation"
									aria-label="pagination">
									<a href="javascript:goFirst(1, 1)" class="pagination-first"><i
										class="ico-chevron-left-thin"></i><i
										class="ico-chevron-left-thin"></i><span class="sr-only">처음
											목록</span></a> <a href="javascript:goPrev(1, 1)"
										class="pagination-previous"><i
										class="ico-chevron-left-thin"></i><span class="sr-only">이전
											페이지 목록</span></a>
									<ul class="pagination-list">


										<li><a href="javascript:goPage(1)"
											class="pagination-link is-current">1</a></li>


									</ul>
									<a href="javascript:goNext(1, 1)" class="pagination-next"><i
										class="ico-chevron-right-thin"></i><span class="sr-only">다음
											페이지 목록</span></a> <a href="javascript:goLast(1, 1)"
										class="pagination-last"><i class="ico-chevron-right-thin"></i><i
										class="ico-chevron-right-thin"></i><span class="sr-only">마지막
											목록</span></a>
								</nav>
							</div>

						</span>

					</section>

					<form id="delete_order_item"
						action="/livart/orderlist?command=delete" method="post">
						<input type="hidden" name="productid" class="productid"> <input
							type="hidden" name="orderid" class="orderid">

					</form>

					<form id="write_review_item" action="/livart/reviewform"
						method="post">
						<input type="hidden" name="p_id" class="p_id">
						<input type="hidden" name="o_id" class="o_id">
					</form>

					<!-- 배송조회 popup -->
					<div id="modal-shipGuide" class="modal">
						<div class="modal-background"></div>
						<div class="modal-card">
							<header class="modal-card-head">
								<p class="modal-card-title">배송안내</p>
								<button class="delete is-large" aria-label="close"></button>
							</header>
							<section class="modal-card-body">
								<h3 class="hidden">배송안내</h3>
								<div class="content mt2">
									<div class="dl-table-style">
										<dl class="dl-table-style__dl">
											<dt class="dl-table-style__dt">배송기사</dt>
											<dd class="dl-table-style__dd" id="trackNm"></dd>
										</dl>
										<dl class="dl-table-style__dl">
											<dt class="dl-table-style__dt">연락처</dt>
											<dd class="dl-table-style__dd" id="trackHp"></dd>
										</dl>
									</div>
								</div>
							</section>
							<div class="modal-card-foot">
								<button type="button"
									class="button is-primary button-modal-close">확인</button>
							</div>
						</div>
					</div>

					<!-- S : 20년 11월 이전 주문내역 popup -->
					<div id="modal-claim-history-20" class="modal">
						<div class="modal-background"></div>
						<div class="modal-card" style="width: 1000px;">
							<header class="modal-card-head">
								<p class="modal-card-title">20년 12월 이전 취소/반품/교환 내역</p>
								<button type="button" class="delete is-large" aria-label="close"
									onclick="changePrimary();"></button>
							</header>

							<div id="mypageAsisClaimList"></div>

						</div>
					</div>
					<!-- E : 20년 11월 이전 주문내역 popup -->

					<script type="text/javascript">
						$(".delete_btn").on("click", function(e) {
							e.preventDefault;

							let o_id = $(this).data("orderid");
							let p_id = $(this).data("productid");

							console.log(p_id);
							console.log(o_id);

							$(".orderid").val(o_id);
							$('.productid').val(p_id);
							$("#delete_order_item").submit();
						});
						

						$(".review_btn").on("click", function(e) {
							e.preventDefault;

							let o_id = $(this).data("orderid");
							let p_id = $(this).data("productid");

							console.log(p_id);
							console.log(o_id);

							$(".o_id").val(o_id);
							$('.p_id').val(p_id);
							$("#write_review_item").submit();
						});

						/***********************
						 * 클레임 목록 조회
						 ***********************/
						function selectMypageClaimList(pn) {
							$.PAGING_INFO.pageNo = pn;
							$.PAGING_INFO.startDate = $("#startDate").val()
									.replace(/-/gi, "");
							$.PAGING_INFO.endDate = $("#endDate").val()
									.replace(/-/gi, "");
							var data = {
								"startDate" : $.PAGING_INFO.startDate,
								"endDate" : $.PAGING_INFO.endDate,
								"pageSize" : $.PAGING_INFO.pageSize,
								"pageNo" : $.PAGING_INFO.pageNo
							}
							var listUrl = "/mypage/selectMypageClaimListAjax";
							if ($.PAGING_INFO.listType == "OLD") {
								listUrl = "/mypage/selectAsisClaimListAjax";
							}
							$.ajax({
								url : listUrl,
								headers : {
									'X-CSRF-TOKEN' : $(
											'meta[name="X-CSRF-TOKEN"]').attr(
											'content')
								},
								data : data,
								dataType : "html",
								async : false,
								success : function(result) {
									if ($.PAGING_INFO.listType == "OLD") {
										$("#mypageAsisClaimList").replaceWith(
												result);
									} else {
										$("#mypageClaimList").replaceWith(
												result);
									}

								},
								error : function(xhr, status, error) {
									console.log(error);
								}
							});
						}

						/***********************
						 * 검색 옵션
						 ***********************/
						$.PAGING_INFO = {
							"pageSize" : 5,
							"pageNo" : 1,
							"startDate" : $("#startDate").val().replace(/-/gi,
									""),
							"endDate" : $("#endDate").val().replace(/-/gi, ""),
							"listType" : "NEW"
						};

						/***********************
						 * 검색월 지정
						 ***********************/
						function setMonth(month) {
							var srtDate = month.replace(/-/gi, ".");
							$("#startDate").val(srtDate);
							$("#endDate").val("2022.12.07");
						}

						/***********************
						 * 신규클레임 페이지 이동
						 ***********************/
						function goNewPage(pn) {
							$.PAGING_INFO.listType = "NEW";
							$("#btnOldOrder").removeClass("is-primary");
							$("#btnNewOrder").addClass("is-primary");
							selectMypageClaimList(pn);
						}

						/***********************
						 * 2011년 이전 페이지 이동
						 ***********************/
						function goOldPage(pn) {
							$.PAGING_INFO.listType = "OLD";
							$("#btnOldOrder").addClass("is-primary");
							$("#btnNewOrder").removeClass("is-primary");
							selectMypageClaimList(pn);
						}

						/***********************
						 * 페이지 이동
						 ***********************/
						function goPage(pn) {

							selectMypageClaimList(pn);
						}

						/***********************
						 * 첫번째 페이지로
						 ***********************/
						function goFirst(pn, pc) {
							if (pn <= 1) {
								alert("첫 페이지 입니다.");
							} else {
								goPage(1);
							}
						}

						/***********************
						 * 이전 페이지로
						 ***********************/
						function goPrev(pn, pc) {
							if (pn <= 1) {
								alert("첫 페이지 입니다.");
							} else {
								goPage(pn - 1);
							}
						}

						/***********************
						 * 마지막 페이지로
						 ***********************/
						function goLast(pn, pc) {
							if (pn >= pc) {
								alert("마지막 페이지 입니다.");
							} else {
								goPage(pc);
							}
						}

						/***********************
						 * 다음 페이지로
						 ***********************/
						function goNext(pn, pc) {
							if (pn >= pc) {
								alert("마지막 페이지 입니다.");
							} else {
								goPage(pn + 1);
							}
						}

						/***********************
						 * 주문 목록 셀 머징을 위한 펑션
						 ***********************/
						function cellMerge(id, span, amt) {
							$("#" + id).attr("rowspan", span);
							$("#" + id).addClass("bundle");
							if (amt != null) {
								$("#" + id + " div")
										.html(
												$.eshopfront.cmm.setComma(amt)
														+ "<span class=\"won\">원</span>");
							}
						}

						/***********************
						 * 검색일 달력 체크
						 ***********************/
						function checkSearchDate() {
							if ($("#startDate").val() > $("#endDate").val()) {
								alert("검색일자를 올바르게 입력하세요.");
								$("#selectMonth01").click();
							}
						}

						/***********************
						 * 재구매
						 ***********************/
						function reBuying(goodsSn, goodsTypeCd) {
							var data = {
								"cartVOList" : [ {
									"goodsSn" : goodsSn,
									"goodsTypeCd" : goodsTypeCd,
									"qty" : "1",
									"bnefSn" : "",
									"mbrCpnSn" : ""
								} ],
								"immedPurYn" : "N"
							};
							if (goodsTypeCd == "01" || goodsTypeCd == "02") {
								$.ajax({
									url : "/cart/insert",
									type : "post",
									data : JSON.stringify(data),
									contentType : "application/json",
									dataType : "json",
									headers : {
										'X-CSRF-TOKEN' : $(
												'meta[name="X-CSRF-TOKEN"]')
												.attr('content')
									},
									success : function(result) {
										console.log(result);
										if (result.resultCode == '00') {
											window.location.href = "/cart";
										} else {
											window.location.href = "/p/"
													+ goodsSn;
										}
									},
									error : function(xhr, status, error) {
										window.location.href = "/p/" + goodsSn;
									}
								});
							} else {
								window.location.href = "/p/" + goodsSn;
							}
						}

						/***********************
						 * init list
						 ***********************/
						$(document).ready(function() {
							goPage(1);
						});

						function changePrimary() {
							$.PAGING_INFO.listType = "NEW";
							$("#btnOldOrder").removeClass("is-primary");
							$("#btnNewOrder").addClass("is-primary");
						}

						/***********************
						 * 직배 배송조회
						 ***********************/
						function trackingDrOrder(trackNm, trackHp) {
							$("#trackNm").text(trackNm);
							$("#trackHp").text(trackHp);
						}

						/***********************
						 * 택배 배송조회
						 ***********************/
						function trackingHdOrder(hdCorpCd, wyblNo) {
							window.open(
									"http://trace.goodsflow.com/VIEW/V1/whereis/livartmall/"
											+ hdCorpCd + "/" + wyblNo,
									"_blank", "width=500,height=500");
						}
					</script>




				</div>
			</div>
		</div>

	</main>

</body>
</html>